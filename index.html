<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Gelombang 3D + AR</title>
  <style>
    body { margin:0; background:#000; font-family:Arial, sans-serif; color:white; }
    #ui { position:fixed; top:10px; left:10px; background:rgba(0,0,0,0.6); padding:12px; border-radius:10px; z-index:10; }
    label { display:block; margin-top:8px; font-size:14px; }
    input, select { width:100%; margin-top:4px; }
    #viewer { width:100%; height:400px; margin-top:8px; background:#111; }
    canvas { display:block; }
  </style>
  <!-- model-viewer untuk AR -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>
  <div id="ui">
    <strong>Kontrol Gelombang</strong>
    <label>Jenis Gelombang
      <select id="type">
        <option value="transverse">Transversal</option>
        <option value="longitudinal">Longitudinal</option>
      </select>
    </label>
    <label>Panjang Gelombang (Î»)
      <input id="wavelength" type="range" min="0.2" max="2" step="0.05" value="1">
    </label>
    <label>Frekuensi (f)
      <input id="frequency" type="range" min="0.5" max="5" step="0.1" value="1">
    </label>
    <label>Amplitudo (A)
      <input id="amplitude" type="range" min="0.05" max="0.5" step="0.01" value="0.2">
    </label>
    <button id="exportBtn">Tampilkan di AR</button>
  </div>

  <!-- Viewer AR -->
  <model-viewer id="viewer" ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1"></model-viewer>

  <!-- Three.js -->
  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.158.0/build/three.module.js";
    import { OrbitControls } from "https://unpkg.com/three@0.158.0/examples/jsm/controls/OrbitControls.js";
    import { GLTFExporter } from "https://unpkg.com/three@0.158.0/examples/jsm/exporters/GLTFExporter.js";

    let scene, camera, renderer, controls, clock;
    let waveObject;
    let params = { type: "transverse", wavelength: 1, frequency: 1, amplitude: 0.2 };

    init();
    animate();

    function init() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x000000);

      camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 100);
      camera.position.set(0,1,3);

      renderer = new THREE.WebGLRenderer({antialias:true});
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      controls = new OrbitControls(camera, renderer.domElement);

      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(3,3,3);
      scene.add(light);
      scene.add(new THREE.AmbientLight(0x666666));

      waveObject = new THREE.Group();
      scene.add(waveObject);

      clock = new THREE.Clock();

      document.getElementById("type").addEventListener("change", e => { params.type=e.target.value; buildWave(); });
      document.getElementById("wavelength").addEventListener("input", e => { params.wavelength=parseFloat(e.target.value); buildWave(); });
      document.getElementById("frequency").addEventListener("input", e => { params.frequency=parseFloat(e.target.value); });
      document.getElementById("amplitude").addEventListener("input", e => { params.amplitude=parseFloat(e.target.value); buildWave(); });

      document.getElementById("exportBtn").addEventListener("click", exportToAR);

      buildWave();
      window.addEventListener("resize", onWindowResize);
    }

    function buildWave() {
      waveObject.clear();

      if(params.type==="transverse"){
        const points = [];
        for(let i=0;i<=100;i++){
          const x = (i/100 - 0.5)*4;
          points.push(new THREE.Vector3(x,0,0));
        }
        const geometry = new THREE.BufferGeometry().setFromPoints(points);
        const material = new THREE.LineBasicMaterial({color:0x00aaff});
        const line = new THREE.Line(geometry, material);
        line.name="waveLine";
        waveObject.add(line);
      } else {
        for(let i=0;i<40;i++){
          const x = (i-20)*0.1;
          const sphere = new THREE.Mesh(
            new THREE.SphereGeometry(0.03,16,16),
            new THREE.MeshStandardMaterial({color:0xff8800})
          );
          sphere.position.set(x,0,0);
          waveObject.add(sphere);
        }
      }
    }

    function animate() {
      requestAnimationFrame(animate);
      const t = clock.getElapsedTime();

      if(params.type==="transverse"){
        const line = waveObject.getObjectByName("waveLine");
        if(line){
          const pos = line.geometry.attributes.position;
          for(let i=0;i<pos.count;i++){
            const x = pos.getX(i);
            const y = params.amplitude*Math.sin((2*Math.PI/params.wavelength)*x - 2*Math.PI*params.frequency*t);
            pos.setZ(i,y);
          }
          pos.needsUpdate = true;
        }
      } else {
        waveObject.children.forEach((sphere,i)=>{
          const x = (i-20)*0.1;
          const disp = params.amplitude*Math.sin((2*Math.PI/params.wavelength)*x - 2*Math.PI*params.frequency*t);
          sphere.position.x = x + disp*0.5;
        });
      }

      controls.update();
      renderer.render(scene, camera);
    }

    function onWindowResize(){
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    async function exportToAR(){
      const exporter = new GLTFExporter();
      exporter.parse(waveObject, gltf=>{
        const blob = new Blob([JSON.stringify(gltf)], {type:"model/gltf+json"});
        const url = URL.createObjectURL(blob);
        document.getElementById("viewer").src = url;
      });
    }
  </script>
</body>
</html>
