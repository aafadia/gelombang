<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>WebAR + 3D Viewer Gelombang</title>
  <style>
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Arial}
    #ui{position:fixed;left:12px;top:12px;z-index:999;backdrop-filter:blur(6px);background:rgba(255,255,255,0.85);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.12);min-width:220px}
    label{display:block;font-size:13px;margin-top:8px;color:#222}
    input[type=range]{width:100%}
    select,input[type=number]{width:100%;padding:6px;border-radius:6px;border:1px solid #ccc}
    button{margin-top:10px;width:100%;padding:8px;border-radius:8px;border:none;background:#0b84ff;color:white;font-weight:600}
    #message{position:fixed;left:50%;bottom:12px;transform:translateX(-50%);background:rgba(0,0,0,0.65);color:white;padding:8px 12px;border-radius:8px}
    model-viewer{width:100%;height:100%;background:#f9f9f9}
  </style>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>
  <div id="ui">
    <strong>Gelombang 3D + AR</strong>
    <label>Jenis Gelombang
      <select id="type">
        <option value="transverse">Transversal</option>
        <option value="longitudinal">Longitudinal</option>
      </select>
    </label>
    <label>Panjang gelombang (λ) — meter
      <input id="wavelength" type="range" min="0.05" max="2" step="0.01" value="0.5">
      <input id="wavelengthNum" type="number" min="0.05" max="2" step="0.01" value="0.5">
    </label>
    <label>Frekuensi (f) — Hz
      <input id="frequency" type="range" min="0.1" max="5" step="0.01" value="1">
      <input id="frequencyNum" type="number" min="0.1" max="5" step="0.01" value="1">
    </label>
    <label>Amplitudo (A) — meter
      <input id="amplitude" type="range" min="0.005" max="0.4" step="0.005" value="0.08">
      <input id="amplitudeNum" type="number" min="0.005" max="0.4" step="0.005" value="0.08">
    </label>
    <button id="updateBtn">Update Gelombang</button>
    <small style="display:block;margin-top:8px;color:#444">Gunakan jari/mouse untuk memutar model 3D. Tombol AR muncul di bawah viewer.</small>
  </div>

  <!-- Model Viewer untuk preview 3D + AR -->
  <model-viewer id="viewer" ar ar-modes="webxr scene-viewer quick-look" camera-controls exposure="1" shadow-intensity="0.6" autoplay>
  </model-viewer>

  <div id="message">Jika perangkat mendukung, gunakan tombol AR di kanan bawah viewer untuk menampilkan gelombang di dunia nyata.</div>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.158.0/build/three.module.js';

    let params = {
      type: 'transverse',
      wavelength: 0.5,
      frequency: 1.0,
      amplitude: 0.08
    };

    const typeEl = document.getElementById('type');
    const wl = document.getElementById('wavelength');
    const wlN = document.getElementById('wavelengthNum');
    const f = document.getElementById('frequency');
    const fN = document.getElementById('frequencyNum');
    const a = document.getElementById('amplitude');
    const aN = document.getElementById('amplitudeNum');
    const viewer = document.getElementById('viewer');

    // fungsi generate gelombang sebagai glTF blob
    async function generateWave(){
      const scene = new THREE.Scene();
      const light = new THREE.HemisphereLight(0xffffff,0x444444,1);
      scene.add(light);
      const camera = new THREE.PerspectiveCamera(45,1,0.1,10);
      camera.position.set(0,0.5,1.5);

      if(params.type==='transverse'){
        const length=2.0, segments=200;
        const geom=new THREE.BufferGeometry();
        const positions=[];
        for(let i=0;i<=segments;i++){
          const x=(i/segments-0.5)*length;
          const z=params.amplitude*Math.sin(2*Math.PI*x/params.wavelength);
          positions.push(x,0,z);
        }
        geom.setAttribute('position', new THREE.Float32BufferAttribute(positions,3));
        const mat=new THREE.LineBasicMaterial({color:0x1560bd});
        const line=new THREE.Line(geom,mat);
        scene.add(line);
      }else{
        const count=60, spacing=0.05;
        const group=new THREE.Group();
        for(let i=0;i<count;i++){
          const baseX=(i-count/2)*spacing;
          const disp=params.amplitude*Math.sin(2*Math.PI*baseX/params.wavelength);
          const sphere=new THREE.Mesh(new THREE.SphereGeometry(0.015,12,12),new THREE.MeshStandardMaterial({color:0xff8c00}));
          sphere.position.set(baseX+disp,0,0);
          group.add(sphere);
        }
        scene.add(group);
      }

      // export to glTF
      const {GLTFExporter}=await import('https://unpkg.com/three@0.158.0/examples/jsm/exporters/GLTFExporter.js');
      const exporter=new GLTFExporter();
      return new Promise(resolve=>{
        exporter.parse(scene,gltf=>{
          const blob=new Blob([JSON.stringify(gltf)],{type:'model/gltf+json'});
          const url=URL.createObjectURL(blob);
          resolve(url);
        },{binary:false});
      });
    }

    async function updateViewer(){
      const url=await generateWave();
      viewer.src=url;
    }

    // sync UI
    typeEl.addEventListener('change',()=>{params.type=typeEl.value;updateViewer();});
    wl.addEventListener('input',()=>{params.wavelength=parseFloat(wl.value);wlN.value=wl.value;});
    wlN.addEventListener('change',()=>{params.wavelength=parseFloat(wlN.value);wl.value=wlN.value;});
    f.addEventListener('input',()=>{params.frequency=parseFloat(f.value);fN.value=f.value;});
    fN.addEventListener('change',()=>{params.frequency=parseFloat(fN.value);f.value=fN.value;});
    a.addEventListener('input',()=>{params.amplitude=parseFloat(a.value);aN.value=a.value;});
    aN.addEventListener('change',()=>{params.amplitude=parseFloat(aN.value);a.value=aN.value;});

    document.getElementById('updateBtn').addEventListener('click',updateViewer);

    // load pertama
    updateViewer();
  </script>
</body>
</html>
